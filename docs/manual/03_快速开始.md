# 快速开始

本指南将带您快速上手 mlp-train，通过一个简单的例子演示如何使用 mlp-train 训练机器学习势能并运行分子动力学模拟。

## 准备工作

1. **激活环境**：根据您要使用的模型，激活相应的 conda 环境
   ```bash
   conda activate mlp-train-gap  # 或 mlp-train-ace, mlp-train-mace
   ```

2. **准备输入文件**：创建一个包含分子结构的 XYZ 文件（例如 `water.xyz`）
   ```
   3
   water
   O    0.0000    0.0000    0.0000
   H    0.7570    0.5860    0.0000
   H   -0.7570    0.5860    0.0000
   ```

## 最简单的例子：训练 GAP 势能

以下是一个完整的示例，展示如何训练一个简单的 GAP 势能：

```python
import mlptrain as mlt

# 设置使用的核心数
mlt.Config.n_cores = 10

# 设置量子化学方法（例如使用 ORCA）
mlt.Config.orca_keywords = ['PBE', 'def2-SVP', 'EnGrad']

# 创建系统（无周期性边界条件）
system = mlt.System(mlt.Molecule('water.xyz'), box=None)

# 初始化 GAP 势能
gap = mlt.potentials.GAP('water', system=system)

# 使用主动学习训练，使用 ORCA 作为参考方法，温度 1000 K
gap.al_train(method_name='orca', temp=1000)

# 运行分子动力学模拟
trajectory = mlt.md.run_mlp_md(
    configuration=system.random_configuration(),
    mlp=gap,
    fs=200,          # 模拟时间 200 fs
    temp=300,        # 温度 300 K
    dt=0.5,          # 时间步长 0.5 fs
    interval=10,     # 每 10 步保存一次
)

# 比较 MLP 预测与真实值
trajectory.compare(gap, 'orca')

# 保存轨迹
trajectory.save(filename='water_trajectory.xyz')
```

## 使用 ACE 模型

```python
import mlptrain as mlt
from mlptrain.training.selection import AtomicEnvSimilarity
from mlptrain.descriptor import SoapDescriptor

mlt.Config.n_cores = 10

# 创建系统
system = mlt.System(mlt.Molecule('water.xyz'), box=None)

# 初始化 ACE 势能
ace = mlt.potentials.ACE('water', system=system)

# 设置描述符和选择器
descriptor = SoapDescriptor(average='outer', r_cut=6.0, n_max=6, l_max=6)
selector = AtomicEnvSimilarity(descriptor=descriptor, threshold=0.9995)

# 使用主动学习训练
ace.al_train(method_name='xtb', selection_method=selector, temp=500)

# 运行 MD 模拟
trajectory = mlt.md.run_mlp_md(
    configuration=system.random_configuration(),
    mlp=ace,
    fs=200,
    temp=300,
    dt=0.5,
    interval=10,
)

trajectory.save(filename='water_trajectory.xyz')
```

## 使用 MACE 模型（OpenMM）

```python
import mlptrain as mlt

mlt.Config.n_cores = 1

# 创建系统
system = mlt.System(mlt.Molecule('water.xyz'), box=None)

# 初始化 MACE 势能
mace = mlt.potentials.MACE('water', system=system)

# 使用主动学习训练（使用 OpenMM）
mace.al_train(
    method_name='xtb',
    temp=500,
    max_active_iters=2,
    max_active_time=50,
    n_configs_iter=3,
    md_program='OpenMM',
)

# 使用 OpenMM 运行 MD 模拟
trajectory = mlt.md_openmm.run_mlp_md_openmm(
    configuration=system.random_configuration(),
    mlp=mace,
    fs=2000,
    temp=300,
    dt=0.5,
    interval=100,
)

trajectory.save(filename='water_trajectory.xyz')
```

## 代码解释

### 1. 导入和配置

```python
import mlptrain as mlt
mlt.Config.n_cores = 10
```

- 导入 mlptrain 模块
- 设置使用的 CPU 核心数

### 2. 创建系统

```python
system = mlt.System(mlt.Molecule('water.xyz'), box=None)
```

- `Molecule('water.xyz')`：从 XYZ 文件读取分子
- `System(..., box=None)`：创建无周期性边界条件的系统

### 3. 初始化 MLP

```python
gap = mlt.potentials.GAP('water', system=system)
```

- 创建名为 'water' 的 GAP 势能
- 该势能将保存为 `water_gap.xml`

### 4. 主动学习训练

```python
gap.al_train(method_name='orca', temp=1000)
```

- `method_name`：参考方法（'orca', 'xtb', 'gaussian' 等）
- `temp`：主动学习时的温度（K）

### 5. 运行 MD 模拟

```python
trajectory = mlt.md.run_mlp_md(
    configuration=system.random_configuration(),
    mlp=gap,
    fs=200,
    temp=300,
    dt=0.5,
    interval=10,
)
```

- `configuration`：起始构型
- `mlp`：训练好的势能
- `fs`：模拟时间（飞秒）
- `temp`：温度（K）
- `dt`：时间步长（fs）
- `interval`：保存间隔（步数）

## 支持的参考方法

mlp-train 支持多种量子化学方法作为参考：

- **xTB**：快速半经验方法（推荐用于快速测试）
- **ORCA**：需要安装 ORCA 并配置
- **Gaussian**：需要安装 Gaussian 并配置
- **GPAW**：基于 DFT 的方法

## 下一步

- 了解 [核心概念](04_核心概念.md)
- 深入学习 [MLP 训练](05_MLP训练.md)
- 查看 [示例教程](09_示例教程.md)
